# Lucid 语言官方使用手册

欢迎来到 `Lucid` 的世界！

`Lucid` 是一门追求极致**清晰**、**高效**和**安全**的现代化编程语言。它融合了函数式编程的优雅、物理单位系统的严谨以及结构化并发的先进思想，旨在为您提供一个与众不同的、强大的编程工具。

## 目录

1.  [核心原则](https://www.google.com/search?q=%231-%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%88%99)
2.  [基础语法](https://www.google.com/search?q=%232-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95)
    - [变量与常量](https://www.google.com/search?q=%23%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B8%B8%E9%87%8F)
    - [数据类型](https://www.google.com/search?q=%23%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)
    - [操作符与优先级](https://www.google.com/search?q=%23%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7)
3.  [特色功能详解](https://www.google.com/search?q=%233-%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%A7%A3)
    - [单位类型系统](https://www.google.com/search?q=%23%E5%8D%95%E4%BD%8D%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F)
    - [函数与闭包](https://www.google.com/search?q=%23%E5%87%BD%E6%95%B0%E4%B8%8E%E9%97%AD%E5%8C%85)
    - [管道操作符](https://www.google.com/search?q=%23%E7%AE%A1%E9%81%93%E6%93%8D%E4%BD%9C%E7%AC%A6)
    - [条件表达式](https://www.google.com/search?q=%23%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F)
    - [结构化并发](https://www.google.com/search?q=%23%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91)
4.  [如何运行](https://www.google.com/search?q=%234-%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C)

---

### 1\. 核心原则

- **清晰简洁**: 语法设计旨在减少认知负担，代码即思想。
- **显式优于隐式**: `Lucid` 鼓励明确的操作，例如乘法必须使用 `*`。
- **一切皆为表达式**: `if/else`、代码块等结构都会返回一个值，增强了语言的组合能力。
- **类型安全**: 通过内置的单位系统，从根本上杜绝物理单位混淆导致的错误。

---

### 2\. 基础语法

#### 变量与常量

`Lucid` 使用 `let` 关键字来声明变量（在当前版本中，所有变量都是不可变的）。

```lucid
// 声明一个数字
let my_age = 30;

// 声明一个字符串
let message = "Hello, Lucid!";

// 语句可以以可选的分号结尾
let a = 10;
let b = 20;
```

#### 数据类型

`Lucid` 目前支持以下基础数据类型：

- **整数 (Integer)**: `10`, `-5`, `123`
- **布尔值 (Boolean)**: `true`, `false`
- **字符串 (String)**: `"hello"`, `"Lucid language"`
- **单位数值 (UnitValue)**: 一种特殊的数值，代表带有物理单位的量。例如 `10m` (`10`米) 或 `9.8kg` (`9.8`千克)。

#### 操作符与优先级

`Lucid` 支持丰富的操作符，它们的优先级从低到高排列如下：

| 优先级 | 操作符               | 描述                  | 结合性     |
| :----- | :------------------- | :-------------------- | :--------- |
| 1      | `\|>`                | 管道操作符            | 左结合     |
| 2      | `==`, `!=`           | 等于 / 不等于         | -          |
| 3      | `>`, `>=`, `<`, `<=` | 比较操作符            | -          |
| 4      | `+`, `-`             | 加 / 减               | 左结合     |
| 5      | `*`, `/`             | 乘 / 除               | 左结合     |
| 6      | `^`                  | 幂运算                | **右结合** |
| 7      | `-` (一元)           | 负号                  | 前缀       |
| 8      | `()`                 | 函数调用 / 表达式分组 | -          |

---

### 3\. 特色功能详解

#### 单位类型系统

这是 `Lucid` 的核心创新点。你可以将物理单位直接附加到数字后面，`Lucid` 会在运算时进行单位检查。

- **定义带单位的数值**:

  ```lucid
  let distance = 100km;
  let time = 2hr;
  ```

  *(注意: `100km` 在`Lucid`中被解析为`100*km`的语法糖)\*

- **同单位运算**:

  ```lucid
  let total_distance = 100km + 50km; // 正确，结果是 150km
  ```

- **复合单位运算**:

  ```lucid
  // 乘法会组合单位
  let area = 10m * 5m; // 结果是 50m^2

  // 除法会创建派生单位
  let speed = 100km / 2hr; // 结果是 50km/hr

  // 单位会自动约分
  let length = 50m^2 / 5m; // 结果是 10m
  ```

- **类型安全检查**:

  ```lucid
  let error_op = 100kg + 10s; // 这将导致 TypeError，因为质量和时间不能相加
  ```

#### 函数与闭包

`Lucid` 中的函数是一等公民，支持强大的闭包特性。

- **函数定义**: 使用 `fn` 关键字，函数体必须由 `{}` 包裹。

  ```lucid
  // 定义一个加法函数
  let add = fn(a, b) {
      return a + b; // 使用 return 显式返回值
  };

  // 函数体中的最后一个表达式会作为隐式返回值
  let multiply = fn(a, b) {
      a * b
  };
  ```

- **函数调用**:

  ```lucid
  add(10, 20);      // 结果是 30
  multiply(5, 6);   // 结果是 30
  ```

- **闭包**: 函数会“捕获”其定义时所在的环境。

  ```lucid
  let make_adder = fn(x) {
      fn(y) {
          x + y // 这里的 x 来自外部函数 make_adder
      }
  };

  let add_ten = make_adder(10); // 创建一个“加10”的新函数
  add_ten(5); // 结果是 15
  ```

#### 管道操作符 `|>`

管道符可以将一个表达式的结果，作为**第一个参数**传递给下一个函数，让数据处理流程极其清晰。

```lucid
let double = fn(n) { n * 2 };
let inc = fn(n) { n + 1 };

// 10 -> double(10) -> 20 -> inc(20) -> 21
let result = 10 |> double |> inc; // 结果是 21
```

#### 条件表达式

`if/then/else` 在 `Lucid` 中是一个表达式，它总会返回一个值。

```lucid
let age = 20;
let status = if age >= 18 then "adult" else "minor"; // status 的值是 "adult"

// 分支可以是复杂的代码块
let message = if status == "adult" {
    "Welcome to the club!"
} else {
    "Sorry, you are too young."
};
```

#### 结构化并发

`Lucid` 提供了 `spawn` 和 `await` 关键字，用于编写简洁、安全的并发代码。

- `spawn { ... }`: 启动一个并发任务，并立即返回一个任务句柄（Task）。
- `await <task>`: 等待一个任务句柄完成，并获取其结果。

<!-- end list -->

```lucid
// 启动一个后台任务
let my_task = spawn {
    // 模拟复杂计算
    let a = 100 * 200;
    return a;
};

// 在主流程中可以做其他事情
let b = 1 + 1;

// 在需要的时候，等待后台任务的结果
let task_result = await my_task; // task_result 的值会是 20000
```

_(注意：在当前的 `v3.3` 实现中，并发是**串行模拟**的，用于验证语法和结构。在未来的版本中，这将由真正的多线程引擎驱动。)_

---

### 4\. 如何运行

1.  **启动交互式环境 (REPL)**:
    在你的项目根目录下，运行：

    ```bash
    python -m src.lucid
    ```

    然后你就可以在 `lucid>` 提示符后输入代码了。

2.  **运行自动化测试**:
    为了确保语言核心的稳定，你可以随时运行我们的测试套件：

    ```bash
    python run_tests.py
    ```
